# 百度分析集成说明

## 概述

已成功集成百度统计（百度分析）到站点中，可以追踪用户访问行为和页面浏览量。

## 配置步骤

### 1. 获取百度统计代码

1. 访问 [百度统计官网](https://tongji.baidu.com/)
2. 注册/登录百度账号
3. 添加网站，获取统计代码ID（格式如：`xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`）

### 2. 设置环境变量

在项目根目录的 `.env.local` 文件中添加：

```bash
NEXT_PUBLIC_BAIDU_ANALYTICS_ID=6e012670b184d445bf3ee7f3d68741d4
```

**注意**：这是您的站点专用的百度统计ID。

### 3. 部署配置

如果使用 Vercel 部署，在 Vercel 项目设置中添加环境变量：
- Key: `NEXT_PUBLIC_BAIDU_ANALYTICS_ID`
- Value: `6e012670b184d445bf3ee7f3d68741d4`

## 技术实现

### 文件结构

```
components/
├── analytics.tsx          # 主分析组件（包含 Vercel Analytics 和百度分析）
├── baidu-analytics.tsx    # 百度分析组件
env.mjs                    # 环境变量配置
```

### 功能特性

- ✅ **自动页面追踪**：使用 Next.js `usePathname` 自动追踪路由变化
- ✅ **按需加载**：只在配置了ID时才加载百度统计脚本
- ✅ **TypeScript 支持**：完整的类型定义
- ✅ **SPA 路由支持**：正确处理 Next.js App Router 的客户端导航

### 代码说明

#### BaiduAnalytics 组件主要功能：

1. **脚本注入**：完全按照百度官方代码格式动态加载统计脚本
2. **路由监听**：监听页面路径变化并发送统计数据
3. **防重复加载**：确保百度统计脚本只加载一次
4. **条件渲染**：未配置ID时不执行任何操作

#### 与百度官方代码的对比：

**百度官方代码：**
```javascript
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6e012670b184d445bf3ee7f3d68741d4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
```

**我们的实现：**
- ✅ 完全匹配百度官方的脚本注入逻辑
- ✅ 使用立即执行函数（IIFE）
- ✅ 动态ID配置，支持环境变量
- ✅ 额外的 Next.js 路由追踪功能

## 使用方法

配置完成后，百度分析会自动开始工作：

1. **页面访问统计**：每次用户访问页面都会自动记录
2. **路由变化追踪**：SPA 内的页面切换也会被正确追踪
3. **实时数据**：数据会实时发送到百度统计后台

## 验证集成

1. 配置环境变量后重启开发服务器
2. 访问网站，检查浏览器开发者工具的 Network 标签
3. 应该能看到对 `hm.baidu.com` 的请求
4. 在百度统计后台查看实时访客数据

## 注意事项

- 百度统计ID必须以 `NEXT_PUBLIC_` 前缀，以便在客户端访问
- 首次配置后，数据可能需要几分钟才会在百度统计后台显示
- 环境变量更改后需要重新部署应用

## 与其他分析工具的兼容性

当前配置同时支持：
- ✅ Vercel Analytics
- ✅ 百度统计

两者可以并行工作，互不干扰。